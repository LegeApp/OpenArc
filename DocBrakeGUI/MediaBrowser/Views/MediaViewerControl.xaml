<UserControl x:Class="DocBrake.MediaBrowser.Views.MediaViewerControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:DocBrake.MediaBrowser.Converters"
             xmlns:coreConverters="clr-namespace:DocBrake.Converters"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800"
             Background="Transparent"
             MouseWheel="UserControl_MouseWheel"
             MouseLeftButtonDown="UserControl_MouseLeftButtonDown"
             MouseMove="UserControl_MouseMove"
             MouseLeftButtonUp="UserControl_MouseLeftButtonUp">

    <UserControl.Resources>
        <converters:PanningCursorConverter x:Key="PanningCursorConverter"/>
        <coreConverters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <coreConverters:InverseBoolToVisibilityConverter x:Key="InverseBoolToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid x:Name="RootGrid" Background="Transparent">

        <Grid x:Name="ImageContainer"
              Visibility="{Binding IsVideo, Converter={StaticResource InverseBoolToVisibilityConverter}}">

            <Viewbox x:Name="FitImageViewbox"
                     Stretch="Uniform"
                     Visibility="{Binding IsFitToWindow, Converter={StaticResource BoolToVisibilityConverter}}">
                <Image Source="{Binding DisplayBitmap}"
                       RenderOptions.BitmapScalingMode="HighQuality"
                       Stretch="Uniform" />
            </Viewbox>

            <!-- Manual zoom mode with ScrollViewer for large images -->
            <ScrollViewer x:Name="ImageScrollViewer"
                          HorizontalScrollBarVisibility="Auto"
                          VerticalScrollBarVisibility="Auto"
                          Background="Transparent"
                          Padding="0"
                          Visibility="{Binding IsFitToWindow, Converter={StaticResource InverseBoolToVisibilityConverter}}">

                <Image x:Name="DisplayImage"
                       Source="{Binding DisplayBitmap}"
                       RenderOptions.BitmapScalingMode="HighQuality"
                       Stretch="None">
                    <Image.LayoutTransform>
                        <ScaleTransform ScaleX="{Binding ZoomLevel}"
                                        ScaleY="{Binding ZoomLevel}"/>
                    </Image.LayoutTransform>
                </Image>
            </ScrollViewer>
        </Grid>

        <MediaElement x:Name="VideoPlayer"
                      Source="{Binding VideoSource}"
                      LoadedBehavior="Play"
                      UnloadedBehavior="Stop"
                      Stretch="Uniform"
                      Volume="1"
                      Visibility="{Binding IsVideo, Converter={StaticResource BoolToVisibilityConverter}}"/>

        <Border x:Name="MetadataOverlay"
                HorizontalAlignment="Left"
                VerticalAlignment="Bottom"
                Margin="20"
                Padding="12"
                Background="#CC000000"
                CornerRadius="8"
                MaxWidth="450"
                Visibility="Collapsed">
            <TextBlock Text="{Binding ImageInfo}"
                      Foreground="White"
                      FontSize="14"
                      FontWeight="SemiBold"
                      TextWrapping="Wrap"
                      LineHeight="20"/>
        </Border>

        <Border HorizontalAlignment="Left"
                VerticalAlignment="Bottom"
                Width="160" Height="160"
                Background="Transparent"
                MouseEnter="MetadataHoverArea_MouseEnter"
                MouseLeave="MetadataHoverArea_MouseLeave"/>

        <Border x:Name="ShortcutsOverlay"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="20"
                Padding="12"
                Background="#CC000000"
                CornerRadius="8"
                MaxWidth="380"
                Visibility="Collapsed">
            <TextBlock Text="{Binding ShortcutsLegend}"
                      Foreground="White"
                      FontSize="13"
                      FontWeight="SemiBold"
                      TextWrapping="Wrap"
                      LineHeight="18"/>
        </Border>

        <Border HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Width="180" Height="120"
                Background="Transparent"
                MouseEnter="ShortcutsHoverArea_MouseEnter"
                MouseLeave="ShortcutsHoverArea_MouseLeave"/>

        <!-- Zoom controls overlay -->
        <StackPanel Orientation="Horizontal"
                   HorizontalAlignment="Right"
                   VerticalAlignment="Bottom"
                   Margin="10"
                   Visibility="{Binding IsImageLoaded, Converter={StaticResource BoolToVisibilityConverter}, FallbackValue=Collapsed}">
            <Button Content="âž–"
                   Command="{Binding ZoomOutCommand}"
                   Width="32" Height="32"
                   Background="#EEFFFFFF"
                   Foreground="#FF333333"
                   BorderThickness="1"
                   BorderBrush="#FFC0C0C0"
                   FontSize="14"
                   Margin="0,0,2,0"/>
            <TextBlock Text="{Binding ZoomPercentage}"
                      Background="#EEFFFFFF"
                      Padding="8,6"
                      VerticalAlignment="Center"
                      Foreground="#FF333333"
                      FontSize="12"
                      MinWidth="50"
                      TextAlignment="Center"/>
            <Button Content="âž•"
                   Command="{Binding ZoomInCommand}"
                   Width="32" Height="32"
                   Background="#EEFFFFFF"
                   Foreground="#FF333333"
                   BorderThickness="1"
                   BorderBrush="#FFC0C0C0"
                   FontSize="14"
                   Margin="2,0,0,0"/>
            <Button Content="1:1"
                   Command="{Binding ActualSizeCommand}"
                   Width="40" Height="32"
                   Background="#EEFFFFFF"
                   Foreground="#FF333333"
                   BorderThickness="1"
                   BorderBrush="#FFC0C0C0"
                   FontSize="11"
                   Margin="8,0,0,0"
                   ToolTip="Actual Size (100%)"/>
        </StackPanel>

        <!-- Empty state overlay -->
        <Grid Visibility="{Binding IsImageLoaded, Converter={StaticResource InverseBoolToVisibilityConverter}}">
            <StackPanel VerticalAlignment="Center"
                       HorizontalAlignment="Center">
                <TextBlock Text="ðŸ“·"
                          FontSize="72"
                          HorizontalAlignment="Center"
                          Foreground="#FF999999"
                          Margin="0,0,0,20"/>

                <TextBlock Text="No image loaded"
                          FontSize="20"
                          Foreground="#FF666666"
                          HorizontalAlignment="Center"
                          Margin="0,0,0,10"/>

                <TextBlock Text="Select a thumbnail to preview"
                          FontSize="14"
                          Foreground="#FF888888"
                          HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>
